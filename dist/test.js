"use strict";var e=require("@babel/runtime/helpers/classCallCheck"),t=require("@babel/runtime/helpers/createClass"),r=require("@babel/runtime/regenerator"),a=require("@babel/runtime/helpers/asyncToGenerator"),s=require("ava");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@k2oss/k2-broker-core/test-framework"),require("./CSVUtilities");var o,u,i,d,p=n(e),c=n(t),l=n(r),m=n(a),f=n(s);function h(e,t){global[e]=t}f.default("describe returns the hardcoded instance",(o=m.default(l.default.mark((function e(t){var r;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,h("postSchema",(function(e){r=e})),e.next=4,Promise.resolve(ondescribe({configuration:{}}));case 4:t.deepEqual(r,{objects:{todo:{displayName:"TODO",description:"Manages a TODO list",properties:{id:{displayName:"ID",type:"number"},userId:{displayName:"User ID",type:"number"},title:{displayName:"Title",type:"string"},completed:{displayName:"Completed",type:"boolean"}},methods:{get:{displayName:"Get TODO",type:"read",inputs:["id"],outputs:["id","userId","title","completed"]},getParams:{displayName:"Get TODO",type:"read",parameters:{pid:{displayName:"param1",description:"Description Of Param 1",type:"number"}},requiredParameters:["pid"],outputs:["id"]}}}}}),t.pass();case 6:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})),f.default("execute fails with the wrong parameters",(u=m.default(l.default.mark((function e(t){var r;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.throwsAsync(Promise.resolve(onexecute({objectName:"test1",methodName:"unused",parameters:{},properties:{},configuration:{},schema:{}})));case 2:return r=e.sent,t.deepEqual(r.message,"The object test1 is not supported."),e.next=6,t.throwsAsync(Promise.resolve(onexecute({objectName:"todo",methodName:"test2",parameters:{},properties:{},configuration:{},schema:{}})));case 6:r=e.sent,t.deepEqual(r.message,"The method test2 is not supported."),t.pass();case 9:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})),f.default("execute passes with method params",(i=m.default(l.default.mark((function e(t){var r,a;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){r=e},r=null,h("postResult",a),e.next=5,Promise.resolve(onexecute({objectName:"todo",methodName:"getParams",parameters:{pid:456},properties:{},configuration:{},schema:{}}));case 5:t.deepEqual(r,{id:456}),t.pass();case 7:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})),f.default("execute passes",(d=m.default(l.default.mark((function e(t){var r,a,s;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e){a=e},r=null,h("XMLHttpRequest",function(){function e(){p.default(this,e),r=this.recorder={},this.recorder.headers={}}return c.default(e,[{key:"open",value:function(e,t){this.recorder.opened={method:e,url:t}}},{key:"setRequestHeader",value:function(e,t){this.recorder.headers[e]=t}},{key:"send",value:function(){var e=this;queueMicrotask((function(){e.readyState=4,e.status=200,e.responseText=JSON.stringify({id:123,userId:51,title:"Groceries",completed:!1}),e.onreadystatechange(),delete e.responseText}))}}]),e}()),a=null,h("postResult",s),e.next=8,Promise.resolve(onexecute({objectName:"todo",methodName:"get",parameters:{},properties:{id:123},configuration:{},schema:{}}));case 8:t.deepEqual(r,{opened:{method:"GET",url:"https://jsonplaceholder.typicode.com/todos/123"},headers:{test:"test value"}}),t.deepEqual(a,{id:123,userId:51,title:"Groceries",completed:!1}),t.pass();case 11:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)}));
//# sourceMappingURL=test.js.map
